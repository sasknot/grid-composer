/*!
 * jQuery Grid Composer
 *   
 *  @package    app.js
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @copyright  
 *  @link       /src/jquery.grid-composer.js
 *  @since      0.0.0
**/
var jqGCTimer=!1;!function(i){"use strict";var e={settings:{},init:function(){},addToGrid:function(e,t,n){if(i(this).closest(".gc-container").find(".gc-components").data("colliding"))return!1;var s=i(t.draggable).clone(),o=t.offset.left-i(this).offset().left,r=t.offset.top-i(this).offset().top;s.removeClass("gc-component-item ui-draggable").addClass("gc-grid-item"),s.data("id",t.draggable.data("id")),o%n.dimension>0&&(o=Math.round(o/n.dimension)*n.dimension),r%n.dimension>0&&(r=Math.round(r/n.dimension)*n.dimension),s.css({left:o,top:r}).appendTo(this),i(this).children(".gc-grid-item:not(.gc-immobile)").draggable({containment:"parent",cursor:"move",grid:[n.dimension,n.dimension],zIndex:4,drag:function(e,t){var s=i(this).data("last-position");if(s&&s.left==t.position.left&&s.top==t.position.top){var o=t.position.left+i(this).width()==i(this).parent().width();o?jqGCTimer||(jqGCTimer=setTimeout(function(){var e=i(".gc-container .gc-grid.gc-grid-with-timer");e.length>0&&e.find(".gc-trash").addClass("open"),e.removeClass("gc-grid-with-timer"),jqGCTimer=!1},500),i(this).parent().addClass("gc-grid-with-timer")):(jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"))}else jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer");if(n.collision&&i(this).hasClass("gc-can-overlay")===!1){var r=!1,d={x:t.position.left,y:t.position.top,w:i(this).width(),h:i(this).height()};i(this).addClass("gc-dragging"),i(this).siblings(".gc-grid-item:not(.gc-can-overlay)").each(function(){i(this).removeClass("gc-dragging");var e={x:i(this).position().left,y:i(this).position().top,w:i(this).width(),h:i(this).height()};return r=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(d,e),r?!1:void 0}),r?t.position=i(this).data("last-position"):i(this).data("last-position",t.position)}else i(this).data("last-position",t.position)}}),i(this).children('[class*="gc-resize"]:not(.ui-resizable)').each(function(){var e=i(this).attr("class").match(/gc-resize[-a-z]*/)[0].split("-");if(e.length>2){var t=e.slice(2).join(", ");i(this).resizable({containment:"parent",handles:t,grid:n.dimension,minWidth:i(this).width(),minHeight:i(this).height(),maxWidth:500,maxHeight:500})}}),i(t.draggable).trigger("on-drop",s)},removeFromGrid:function(e){i(e).fadeOut(200,function(){i(e).siblings(".gc-trash").removeClass("open"),i(e).parent().removeClass("gc-grid-with-timer"),i(e).remove()})}};i.fn.gridComposer=function(t){var n=i.extend({},i.fn.gridComposer.defaults,t);return n.dimension||i.error("Grid Composer: dimension must be defined"),n.columns?n.width=n.columns*n.dimension:n.width?(n.columns=n.width/n.dimension,n.columns%n.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid Composer: columns or width must be defined to calculate the grid"),n.lines?n.height=n.lines*n.dimension:n.height?(n.lines=n.height/n.dimension,n.height%n.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid omposer: lines or height must be defined to calculate the grid"),this.each(function(){var t=i(this),s=i("<div></div>").addClass("gc-grid");if(t.addClass("gc-container").width(n.width),s.width(n.width).height(n.height),n.showGrid){for(var o=i("<div></div>").addClass("gc-grid-helper"),r=0;r<n.columns*n.lines;r++)i("<div></div>").width(n.dimension).height(n.dimension).appendTo(o);o.appendTo(s)}if(n.components&&n.components.length>0){var d=i("<div></div>").addClass("gc-components");i.each(n.components,function(e,t){if(t.lines&&t.columns){var s;s=i("<div></div>").addClass("gc-component-item").width(t.columns*n.dimension).height(t.lines*n.dimension).data("id",t.id||0),i.each(t.elements,function(e,t){var n=i("<img />").attr({src:t.image,alt:"",title:""});t.css&&n.css(t.css),s.append(n)}),t.overlay&&s.addClass("gc-can-overlay"),t.immobile&&s.addClass("gc-immobile"),t.resize&&t.resize.length>0&&s.addClass("gc-resize-"+t.resize.join("-")),t.onDrop&&s.on("on-drop",t.onDrop),s.appendTo(d)}else i.error("Grid Composer: component "+t.name+" must have a columns and lines number defined")}),d.appendTo(t),d.children().draggable({helper:"clone",revert:function(i){return i?i.siblings(".gc-components").data("colliding")?!0:void 0:!0},drag:function(e,t){var s=!1;if(n.collision&&i(this).hasClass("gc-can-overlay")===!1){var o={x:t.offset.left,y:t.offset.top,w:i(t.helper).width(),h:i(t.helper).height()};i(this).closest(".gc-container").find(".gc-grid .gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).offset().left,y:i(this).offset().top,w:i(this).width(),h:i(this).height()};return s=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(o,e),s?!1:void 0})}i(this).parent().data("colliding",s)}});var a=i("<div></div>").addClass("gc-trash");a.droppable({accept:".gc-grid-item",tolerance:"touch",drop:function(i,t){e.removeFromGrid.apply(e,t.draggable)}}),a.appendTo(s)}s.droppable({accept:".gc-component-item",tolerance:"fit",drop:function(i,t){e.addToGrid.apply(this,[i,t,n])}}),s.appendTo(t)})},i.fn.gridComposer.defaults={showGrid:!0,collision:!1}}(jQuery);