/*!
 * jQuery Grid Composer
 *   
 *  @package    app.js
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @copyright  
 *  @link       /src/jquery.grid-composer.js
 *  @since      0.0.0
**/
!function(i){"use strict";i.fn.gridComposer=function(e){var n=i.extend({},i.fn.gridComposer.defaults,e);return n.columns&&n.lines?(n.width=n.columns*n.dimension,n.height=n.lines*n.dimension):n.width&&n.height?(n.columns=n.width/n.dimension,n.lines=n.height/n.dimension):i.error("Grid Composer: columns and lines or width and height must be defined to calculate the grid"),this.each(function(){var e=i(this),t=i("<div></div>").addClass("gc-grid");if(e.addClass("gc-container"),t.width(n.width).height(n.height),n.showGrid){for(var o=i("<div></div>").addClass("gc-grid-helper"),s=0;s<n.columns*n.lines;s++)i("<div></div>").width(n.dimension).height(n.dimension).appendTo(o);o.appendTo(t)}if(n.components&&n.components.length>0){var d=i("<div></div>").addClass("gc-components");i.each(n.components,function(e,t){if(t.lines&&t.columns){var o;o=i("<div></div>").addClass("gc-component-item").width(t.columns*n.dimension).height(t.lines*n.dimension),i.each(t.elements,function(e,n){var t=i("<img />").attr({src:n.image,alt:"",title:""});n.css&&t.css(n.css),o.append(t)}),t.overlay&&o.addClass("gc-can-overlay"),t.immobile&&o.addClass("gc-immobile"),t.resize&&t.resize.length>0&&o.addClass("gc-resize-"+t.resize.join("-")),t.onDrop&&o.on("on-drop",t.onDrop),o.appendTo(d)}else i.error("Grid Composer: component "+t.name+" must have a columns and lines number defined")}),d.appendTo(e),d.children().draggable({helper:"clone",revert:function(i){return i?i.siblings(".gc-components").data("colliding")?!0:void 0:!0},drag:function(e,n){var t=!1,o={x:n.offset.left,y:n.offset.top,w:i(n.helper).width(),h:i(n.helper).height()};i(this).closest(".gc-container").find(".gc-grid .gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).offset().left,y:i(this).offset().top,w:i(this).width(),h:i(this).height()};return t=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(o,e),t?!1:void 0}),i(this).parent().data("colliding",t)}})}t.droppable({accept:".gc-component-item",tolerance:"fit",drop:function(e,t){if(i(this).closest(".gc-container").find(".gc-components").data("colliding"))return!1;var o=i(t.draggable).clone(),s=t.offset.left-i(this).offset().left,d=t.offset.top-i(this).offset().top;o.removeClass("gc-component-item ui-draggable").addClass("gc-grid-item"),s%n.dimension>0&&(s=Math.round(s/n.dimension)*n.dimension),d%n.dimension>0&&(d=Math.round(d/n.dimension)*n.dimension),o.css({left:s,top:d}).appendTo(this),i(this).children("*:not(.gc-grid-helper, .gc-immobile)").draggable({containment:"parent",cursor:"move",grid:[n.dimension,n.dimension],drag:function(e,n){if(i(this).hasClass("gc-can-overlay")===!1){var t=!1,o={x:n.position.left,y:n.position.top,w:i(this).width(),h:i(this).height()};i(this).siblings(".gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).position().left,y:i(this).position().top,w:i(this).width(),h:i(this).height()};return t=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(o,e),t?!1:void 0}),t?n.position=i(this).data("last-position"):i(this).data("last-position",n.position)}}}),i(this).children('[class*="gc-resize"]:not(.ui-resizable)').each(function(){var e=i(this).attr("class").match(/gc-resize[-a-z]*/)[0].split("-");if(e.length>2){var t=e.slice(2).join(", ");i(this).resizable({containment:"parent",handles:t,grid:n.dimension,minWidth:i(this).width(),minHeight:i(this).height(),maxWidth:500,maxHeight:500})}}),i(t.draggable).trigger("on-drop",o)}}),t.appendTo(e)})},i.fn.gridComposer.defaults={showGrid:!0}}(jQuery);