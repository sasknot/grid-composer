/*!
 * jQuery Grid Composer
 *   
 *  @package    app.js
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @copyright  
 *  @link       /src/jquery.grid-composer.js
 *  @since      0.0.0
**/
var jqGCTimer=!1;!function(i){"use strict";i.fn.gridComposer=function(e){var t=i.extend({},i.fn.gridComposer.defaults,e);return t.dimension||i.error("Grid Composer: dimension must be defined"),t.columns?t.width=t.columns*t.dimension:t.width?(t.columns=t.width/t.dimension,t.columns%t.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid Composer: columns or width must be defined to calculate the grid"),t.lines?t.height=t.lines*t.dimension:t.height?(t.lines=t.height/t.dimension,t.height%t.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid Composer: lines or height must be defined to calculate the grid"),this.each(function(){var e=i(this),s=i("<div></div>").addClass("gc-grid");if(e.addClass("gc-container").width(t.width),s.width(t.width).height(t.height),t.showGrid){for(var n=i("<div></div>").addClass("gc-grid-helper"),o=0;o<t.columns*t.lines;o++)i("<div></div>").width(t.dimension).height(t.dimension).appendTo(n);n.appendTo(s)}if(t.components&&t.components.length>0){var r=i("<div></div>").addClass("gc-components");i.each(t.components,function(e,s){if(s.lines&&s.columns){var n;n=i("<div></div>").addClass("gc-component-item").width(s.columns*t.dimension).height(s.lines*t.dimension).data("id",s.id||0),i.each(s.elements,function(e,t){var s=i("<img />").attr({src:t.image,alt:"",title:""});t.css&&s.css(t.css),n.append(s)}),s.overlay&&n.addClass("gc-can-overlay"),s.immobile&&n.addClass("gc-immobile"),s.resize&&s.resize.length>0&&n.addClass("gc-resize-"+s.resize.join("-")),s.onDrop&&n.on("on-drop",s.onDrop),n.appendTo(r)}else i.error("Grid Composer: component "+s.name+" must have a columns and lines number defined")}),r.appendTo(e),r.children().draggable({helper:"clone",revert:function(i){return i?i.siblings(".gc-components").data("colliding")?!0:void 0:!0},drag:function(e,s){var n=!1;if(t.collision&&i(this).hasClass("gc-can-overlay")===!1){var o={x:s.offset.left,y:s.offset.top,w:i(s.helper).width(),h:i(s.helper).height()};i(this).closest(".gc-container").find(".gc-grid .gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).offset().left,y:i(this).offset().top,w:i(this).width(),h:i(this).height()};return n=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(o,e),n?!1:void 0})}i(this).parent().data("colliding",n)}});var d=i("<div></div>").addClass("gc-trash");d.droppable({accept:".gc-grid-item",tolerance:"touch",drop:function(e,t){t.draggable.fadeOut(200,function(){i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"),i(this).remove()})}}),d.appendTo(s)}s.droppable({accept:".gc-component-item",tolerance:"fit",drop:function(e,s){if(i(this).closest(".gc-container").find(".gc-components").data("colliding"))return!1;var n=i(s.draggable).clone(),o=s.offset.left-i(this).offset().left,r=s.offset.top-i(this).offset().top;n.removeClass("gc-component-item ui-draggable").addClass("gc-grid-item"),n.data("id",s.draggable.data("id")),o%t.dimension>0&&(o=Math.round(o/t.dimension)*t.dimension),r%t.dimension>0&&(r=Math.round(r/t.dimension)*t.dimension),n.css({left:o,top:r}).appendTo(this),i(this).children(".gc-grid-item:not(.gc-immobile)").draggable({containment:"parent",cursor:"move",grid:[t.dimension,t.dimension],zIndex:4,drag:function(e,s){var n=i(this).data("last-position");if(n&&n.left==s.position.left&&n.top==s.position.top){var o=s.position.left+i(this).width()==i(this).parent().width();o?jqGCTimer||(jqGCTimer=setTimeout(function(){var e=i(".gc-container .gc-grid.gc-grid-with-timer");e.length>0&&e.find(".gc-trash").addClass("open"),e.removeClass("gc-grid-with-timer"),jqGCTimer=!1},500),i(this).parent().addClass("gc-grid-with-timer")):(jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"))}else jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer");if(t.collision&&i(this).hasClass("gc-can-overlay")===!1){var r=!1,d={x:s.position.left,y:s.position.top,w:i(this).width(),h:i(this).height()};i(this).addClass("gc-dragging"),i(this).siblings(".gc-grid-item:not(.gc-can-overlay)").each(function(){i(this).removeClass("gc-dragging");var e={x:i(this).position().left,y:i(this).position().top,w:i(this).width(),h:i(this).height()};return r=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(d,e),r?!1:void 0}),r?s.position=i(this).data("last-position"):i(this).data("last-position",s.position)}}}),i(this).children('[class*="gc-resize"]:not(.ui-resizable)').each(function(){var e=i(this).attr("class").match(/gc-resize[-a-z]*/)[0].split("-");if(e.length>2){var s=e.slice(2).join(", ");i(this).resizable({containment:"parent",handles:s,grid:t.dimension,minWidth:i(this).width(),minHeight:i(this).height(),maxWidth:500,maxHeight:500})}}),i(s.draggable).trigger("on-drop",n)}}),s.appendTo(e)})},i.fn.gridComposer.defaults={showGrid:!0,collision:!0}}(jQuery);