/*!
 * jQuery Grid Composer
 *   
 *  @package    app.js
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @copyright  
 *  @link       /src/jquery.grid-composer.js
 *  @since      0.0.0
**/
var jqGCTimer=!1;!function(i){"use strict";var e={settings:{},init:function(){},getComponent:function(e){var t=!1;return i(this).find(".gc-components .gc-component-item").each(function(){return i(this).data("id")==e?(t=i(this),!1):void 0}),t},addToGrid:function(t){var n,o=i(this).find(".gc-grid"),s=e.settings;return o.find(".gc-components").data("colliding")?!1:(t.id&&(t.reference=e.getComponent.call(this,t.id)),n=t.reference.clone(),n.data("id",t.reference.data("id")),n.removeClass("gc-component-item ui-draggable").addClass("gc-grid-item"),t.offsetLeft%s.dimension>0&&(t.offsetLeft=Math.round(t.offsetLeft/s.dimension)*s.dimension),t.offsetTop%s.dimension>0&&(t.offsetTop=Math.round(t.offsetTop/s.dimension)*s.dimension),n.css({left:t.offsetLeft,top:t.offsetTop}).appendTo(o),o.children(".gc-grid-item:not(.gc-immobile)").draggable({containment:"parent",cursor:"move",grid:[s.dimension,s.dimension],zIndex:4,drag:function(e,t){var n=i(this).data("last-position");if(n&&n.left==t.position.left&&n.top==t.position.top){var o=t.position.left+i(this).width()==i(this).parent().width();o?jqGCTimer||(jqGCTimer=setTimeout(function(){var e=i(".gc-container .gc-grid.gc-grid-with-timer");e.length>0&&e.find(".gc-trash").addClass("open"),e.removeClass("gc-grid-with-timer"),jqGCTimer=!1},500),i(this).parent().addClass("gc-grid-with-timer")):(jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"))}else jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer");if(s.collision&&i(this).hasClass("gc-can-overlay")===!1){var r=!1,d={x:t.position.left,y:t.position.top,w:i(this).width(),h:i(this).height()};i(this).addClass("gc-dragging"),i(this).siblings(".gc-grid-item:not(.gc-can-overlay)").each(function(){i(this).removeClass("gc-dragging");var e={x:i(this).position().left,y:i(this).position().top,w:i(this).width(),h:i(this).height()};return r=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(d,e),r?!1:void 0}),r?t.position=i(this).data("last-position"):i(this).data("last-position",t.position)}else i(this).data("last-position",t.position)}}),o.children('[class*="gc-resize"]:not(.ui-resizable)').each(function(){var e=i(this).attr("class").match(/gc-resize[-a-z]*/)[0].split("-");if(e.length>2){var t=e.slice(2).join(", ");i(this).resizable({containment:"parent",handles:t,grid:s.dimension,minWidth:i(this).width(),minHeight:i(this).height(),maxWidth:500,maxHeight:500})}}),void(t.reference&&i(t.reference).trigger("on-drop",n)))},removeFromGrid:function(e){i(e).fadeOut(200,function(){i(e).siblings(".gc-trash").removeClass("open"),i(e).parent().removeClass("gc-grid-with-timer"),i(e).remove()})}};i.fn.gridComposer=function(t){if("string"!=typeof t){var n=i.extend({},i.fn.gridComposer.defaults,t);return e.settings=n,n.dimension||i.error("Grid Composer: dimension must be defined"),n.columns?n.width=n.columns*n.dimension:n.width?(n.columns=n.width/n.dimension,n.columns%n.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid Composer: columns or width must be defined to calculate the grid"),n.lines?n.height=n.lines*n.dimension:n.height?(n.lines=n.height/n.dimension,n.height%n.dimension>0&&i.error("Grid Composer: width is not divisible by the dimension parameter")):i.error("Grid omposer: lines or height must be defined to calculate the grid"),this.each(function(){var t=i(this),o=i("<div></div>").addClass("gc-grid");if(t.addClass("gc-container").width(n.width),o.width(n.width).height(n.height),n.showGrid){for(var s=i("<div></div>").addClass("gc-grid-helper"),r=0;r<n.columns*n.lines;r++)i("<div></div>").width(n.dimension).height(n.dimension).appendTo(s);s.appendTo(o)}if(n.components&&n.components.length>0){var d=i("<div></div>").addClass("gc-components");i.each(n.components,function(e,t){if(t.lines&&t.columns){var o;o=i("<div></div>").addClass("gc-component-item").width(t.columns*n.dimension).height(t.lines*n.dimension).data("id",t.id||0),i.each(t.elements,function(e,t){var n=i("<img />").attr({src:t.image,alt:"",title:""});t.css&&n.css(t.css),o.append(n)}),t.overlay&&o.addClass("gc-can-overlay"),t.immobile&&o.addClass("gc-immobile"),t.resize&&t.resize.length>0&&o.addClass("gc-resize-"+t.resize.join("-")),t.onDrop&&o.on("on-drop",t.onDrop),o.appendTo(d)}else i.error("Grid Composer: component "+t.name+" must have a columns and lines number defined")}),d.appendTo(t),d.children().draggable({helper:"clone",revert:function(i){return i?i.siblings(".gc-components").data("colliding")?!0:void 0:!0},drag:function(e,t){var o=!1;if(n.collision&&i(this).hasClass("gc-can-overlay")===!1){var s={x:t.offset.left,y:t.offset.top,w:i(t.helper).width(),h:i(t.helper).height()};i(this).closest(".gc-container").find(".gc-grid .gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).offset().left,y:i(this).offset().top,w:i(this).width(),h:i(this).height()};return o=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(s,e),o?!1:void 0})}i(this).parent().data("colliding",o)}});var a=i("<div></div>").addClass("gc-trash");a.droppable({accept:".gc-grid-item",tolerance:"touch",drop:function(i,t){e.removeFromGrid.call(e,t.draggable)}}),a.appendTo(o)}o.droppable({accept:".gc-component-item",tolerance:"fit",drop:function(t,n){var o={reference:n.draggable,offsetLeft:n.offset.left-i(this).offset().left,offsetTop:n.offset.top-i(this).offset().top};e.addToGrid.call(i(this).closest(".gc-container")[0],o)}}),o.appendTo(t)})}if(e[t]){var o="object"==typeof arguments[1]?arguments[1]:{};return this.each(function(){e[t].call(this,o)})}},i.fn.gridComposer.defaults={showGrid:!0,collision:!1}}(jQuery);