/*!
 * jQuery Grid Composer
 *   
 *  @package    app.js
 *  @category   jquery plugin
 *  @author     Rafael F. Silva <rafaelfsilva1@gmail.com>
 *  @copyright  
 *  @link       /src/jquery.grid-composer.js
 *  @since      0.0.0
**/
var jqGCTimer=!1;!function(i){"use strict";i.fn.gridComposer=function(e){var t=i.extend({},i.fn.gridComposer.defaults,e);return t.columns&&t.lines?(t.width=t.columns*t.dimension,t.height=t.lines*t.dimension):t.width&&t.height?(t.columns=t.width/t.dimension,t.lines=t.height/t.dimension):i.error("Grid Composer: columns and lines or width and height must be defined to calculate the grid"),this.each(function(){var e=i(this),n=i("<div></div>").addClass("gc-grid");if(e.addClass("gc-container").width(t.width),n.width(t.width).height(t.height),t.showGrid){for(var s=i("<div></div>").addClass("gc-grid-helper"),o=0;o<t.columns*t.lines;o++)i("<div></div>").width(t.dimension).height(t.dimension).appendTo(s);s.appendTo(n)}if(t.components&&t.components.length>0){var a=i("<div></div>").addClass("gc-components");i.each(t.components,function(e,n){if(n.lines&&n.columns){var s;s=i("<div></div>").addClass("gc-component-item").width(n.columns*t.dimension).height(n.lines*t.dimension).data("id",n.id||0),i.each(n.elements,function(e,t){var n=i("<img />").attr({src:t.image,alt:"",title:""});t.css&&n.css(t.css),s.append(n)}),n.overlay&&s.addClass("gc-can-overlay"),n.immobile&&s.addClass("gc-immobile"),n.resize&&n.resize.length>0&&s.addClass("gc-resize-"+n.resize.join("-")),n.onDrop&&s.on("on-drop",n.onDrop),s.appendTo(a)}else i.error("Grid Composer: component "+n.name+" must have a columns and lines number defined")}),a.appendTo(e),a.children().draggable({helper:"clone",revert:function(i){return i?i.siblings(".gc-components").data("colliding")?!0:void 0:!0},drag:function(e,t){var n=!1,s={x:t.offset.left,y:t.offset.top,w:i(t.helper).width(),h:i(t.helper).height()};i(this).closest(".gc-container").find(".gc-grid .gc-grid-item:not(.gc-can-overlay)").each(function(){var e={x:i(this).offset().left,y:i(this).offset().top,w:i(this).width(),h:i(this).height()};return n=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(s,e),n?!1:void 0}),i(this).parent().data("colliding",n)}});var r=i("<div></div>").addClass("gc-trash");r.droppable({accept:".gc-grid-item",drop:function(e,t){t.draggable.fadeOut(200,function(){i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"),i(this).remove()})}}),r.appendTo(n)}n.droppable({accept:".gc-component-item",tolerance:"fit",drop:function(e,n){if(i(this).closest(".gc-container").find(".gc-components").data("colliding"))return!1;var s=i(n.draggable).clone(),o=n.offset.left-i(this).offset().left,a=n.offset.top-i(this).offset().top;s.removeClass("gc-component-item ui-draggable").addClass("gc-grid-item"),s.data("id",n.draggable.data("id")),o%t.dimension>0&&(o=Math.round(o/t.dimension)*t.dimension),a%t.dimension>0&&(a=Math.round(a/t.dimension)*t.dimension),s.css({left:o,top:a}).appendTo(this),i(this).children(".gc-grid-item:not(.gc-immobile)").draggable({containment:"parent",cursor:"move",grid:[t.dimension,t.dimension],drag:function(e,t){var n=i(this).data("last-position");if(n&&n.left==t.position.left&&n.top==t.position.top){var s=t.position.left+i(this).width()==i(this).parent().width();s?jqGCTimer||(jqGCTimer=setTimeout(function(){var e=i(".gc-container .gc-grid.gc-grid-with-timer");e.length>0&&e.find(".gc-trash").addClass("open"),e.removeClass("gc-grid-with-timer"),jqGCTimer=!1},500),i(this).parent().addClass("gc-grid-with-timer")):(jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer"))}else jqGCTimer&&clearTimeout(jqGCTimer),jqGCTimer=!1,i(this).siblings(".gc-trash").removeClass("open"),i(this).parent().removeClass("gc-grid-with-timer");if(i(this).hasClass("gc-can-overlay")===!1){var o=!1,a={x:t.position.left,y:t.position.top,w:i(this).width(),h:i(this).height()};i(this).addClass("gc-dragging"),i(this).siblings(".gc-grid-item:not(.gc-can-overlay)").each(function(){i(this).removeClass("gc-dragging");var e={x:i(this).position().left,y:i(this).position().top,w:i(this).width(),h:i(this).height()};return o=function(i,e){return!(i.y+i.h<=e.y||i.y>=e.y+e.h||i.x+i.w<=e.x||i.x>=e.x+e.w)}(a,e),o?!1:void 0}),o?t.position=i(this).data("last-position"):i(this).data("last-position",t.position)}}}),i(this).children('[class*="gc-resize"]:not(.ui-resizable)').each(function(){var e=i(this).attr("class").match(/gc-resize[-a-z]*/)[0].split("-");if(e.length>2){var n=e.slice(2).join(", ");i(this).resizable({containment:"parent",handles:n,grid:t.dimension,minWidth:i(this).width(),minHeight:i(this).height(),maxWidth:500,maxHeight:500})}}),i(n.draggable).trigger("on-drop",s)}}),n.appendTo(e)})},i.fn.gridComposer.defaults={showGrid:!0}}(jQuery);